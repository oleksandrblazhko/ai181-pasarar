# **Тест конфігурації платформи програми**

## **Резюме**

Правильна конфігурація окремих елементів, які складають архітектуру програми, важлива для запобігання помилкам, які можуть поставити під загрозу безпеку всієї архітектури.

Перегляд і тестування конфігурації є критично важливим завданням у створенні та підтримці архітектури. Це пов’язано з тим, що багато різних систем зазвичай постачаються із загальними конфігураціями, які можуть не відповідати завданням, які вони виконуватимуть на конкретному сайті, на якому вони встановлені.

Хоча типова інсталяція веб-сервера та сервера додатків міститиме багато функціональних можливостей (наприклад, приклади додатків, документацію, тестові сторінки), те, що є несуттєвим, слід видалити перед розгортанням, щоб уникнути використання після встановлення.

## **Цілі тесту**

- Переконайтеся, що стандартні та відомі файли видалено.
- Перевірте, чи не залишилося коду налагодження чи розширень у виробничих середовищах.
- Перегляньте встановлені для програми механізми журналювання.

## **Як тестувати**

### **Тестування чорної скриньки**

#### **Зразки та відомі файли та каталоги**

Багато веб-серверів і серверів додатків надають під час інсталяції за замовчуванням приклади програм і файлів для розробника та для того, щоб перевірити, чи сервер працює належним чином одразу після встановлення. Однак пізніше стало відомо, що багато програм веб-сервера за замовчуванням є вразливими. Так було, наприклад, для CVE-1999-0449 (відмова в обслуговуванні в IIS, коли було встановлено сайт зразка Exair), CAN-2002-1744 (уразливість проходження каталогу в CodeBrws.asp у Microsoft IIS 5.0), CAN -2002-1630 (Використання sendmail.jsp в Oracle 9iAS) або CAN-2003-1172 (Обхід каталогу у прикладі джерела перегляду в Apache's Cocoon).

Сканери CGI включають докладний список відомих файлів і зразків каталогів, які надаються різними веб-серверами або серверами програм, і можуть бути швидким способом визначити, чи присутні ці файли. Однак єдиний спосіб бути справді впевненим — виконати повний огляд вмісту веб-сервера або сервера програм і визначити, чи пов’язані вони з самою програмою чи ні.

#### **Огляд коментарів**

Програмісти дуже часто додають коментарі під час розробки великих веб-додатків. Однак коментарі, включені в HTML-код, можуть виявити внутрішню інформацію, яка не повинна бути доступна зловмиснику. Іноді навіть вихідний код коментується, оскільки функція більше не потрібна, але цей коментар витікає на HTML-сторінки, які ненавмисно повертаються користувачам.

Необхідно перевірити коментарі, щоб визначити, чи відбувається витік інформації через коментарі. Цей огляд можна виконати лише шляхом аналізу статичного та динамічного вмісту веб-сервера та пошуку файлів. Може бути корисним перегляд сайту в автоматичному або керованому режимі та збереження всього отриманого вмісту. Цей отриманий вміст можна потім шукати, щоб проаналізувати будь-які коментарі HTML, доступні в коді.

#### **Конфігурація системи**

Різноманітні інструменти, документи або контрольні списки можна використовувати, щоб надати фахівцям з ІТ та безпеки детальну оцінку відповідності цільових систем різним базовим параметрам конфігурації або тестам. Такі інструменти включають (але не обмежуються ними):

- CIS-CAT Lite
- Аналізатор поверхні атак Microsoft
- Національна програма контрольного списку NIST

### **Тестування сірого ящика**

#### **Огляд конфігурації**

Конфігурація веб-сервера або сервера додатків відіграє важливу роль у захисті вмісту сайту, і її необхідно ретельно перевірити, щоб виявити типові помилки конфігурації. Очевидно, що рекомендована конфігурація залежить від політики сайту та функціональних можливостей, які має забезпечувати програмне забезпечення сервера. Однак у більшості випадків слід дотримуватися вказівок щодо конфігурації (наданих постачальником програмного забезпечення або зовнішніми сторонами), щоб визначити, чи належним чином захищено сервер.

Неможливо узагальнено сказати, як має бути налаштований сервер, однак слід взяти до уваги деякі загальні рекомендації:

- Увімкніть лише серверні модулі (розширення ISAPI у випадку IIS), які потрібні для програми. Це зменшує поверхню атаки, оскільки сервер зменшується в розмірі та складності, оскільки програмні модулі вимкнено. Це також запобігає впливу вразливостей, які можуть з’явитися в програмному забезпеченні постачальника, на сайт, якщо вони присутні лише в модулях, які вже вимкнено.
- Обробляйте помилки сервера (40x або 50x) за допомогою спеціально створених сторінок замість сторінок веб-сервера за замовчуванням. Зокрема, переконайтеся, що будь-які помилки програми не повертаються кінцевому користувачеві та що через ці помилки не відбувається витоку коду, оскільки це допоможе зловмиснику. Насправді дуже часто забувають про це, оскільки ця інформація потрібна розробникам у передвиробничих середовищах.
- Переконайтеся, що програмне забезпечення сервера працює з мінімізованими привілеями в операційній системі. Це запобігає помилці в серверному програмному забезпеченні від безпосередньої компрометації всієї системи, хоча зловмисник може підвищити привілеї після запуску коду як веб-сервера.
- Переконайтеся, що серверне програмне забезпечення належним чином реєструє законний доступ і помилки.
- Переконайтеся, що сервер налаштовано на належну обробку перевантажень і запобігання атакам типу «відмова в обслуговуванні». Переконайтеся, що продуктивність сервера налаштована належним чином.
- Ніколи не надавайте неадміністративним особам (за винятком `NT SERVICE\WMSvc`) доступ до applicationHost.config, redirection.config і Administration.config (доступ для читання або запису). Це включає в себе `Network Service`, `IIS_IUSRS`, `IUSR` або будь-який настроюваний ідентифікатор, який використовується пулами програм IIS. Робочі процеси IIS не призначені для прямого доступу до жодного з цих файлів.
- Ніколи не розголошуйте файли applicationHost.config, redirection.config і Administration.config у мережі. Використовуючи спільну конфігурацію, віддайте перевагу експорту applicationHost.config в інше місце (див. розділ під назвою «Налаштування дозволів для спільної конфігурації»).
- Майте на увазі, що всі користувачі можуть читати .NET Framework файли `machine.config` і root `web.config` за умовчанням. Не зберігайте конфіденційну інформацію в цих файлах, якщо це має бути лише для очей адміністратора.
- Шифруйте конфіденційну інформацію, яку мають читати лише робочі процеси IIS, а не інші користувачі на машині.
- Не надавайте доступ на запис ідентифікатору, який веб-сервер використовує для доступу до спільної програми ApplicationHost.config. Цей ідентифікатор повинен мати доступ лише для читання.
- Використовуйте окремий ідентифікатор, щоб опублікувати `applicationHost.config` у спільному ресурсі. Не використовуйте цей ідентифікатор для налаштування доступу до спільної конфігурації на веб-серверах.
- Використовуйте надійний пароль під час експорту ключів шифрування для використання зі спільною конфігурацією.
- Зберігайте обмежений доступ до спільного ресурсу, який містить спільну конфігурацію та ключі шифрування. Якщо цей спільний ресурс зламано, зловмисник зможе читати та писати будь-які конфігурації IIS для ваших веб-серверів, перенаправляти трафік із вашого веб-сайту на зловмисні джерела, а в деяких випадках отримати контроль над усіма веб-серверами, завантажуючи довільний код у робочий IIS процеси.
- Спробуйте захистити цей спільний ресурс правилами брандмауера та політиками IPsec, щоб дозволити підключення лише членським веб-серверам.

#### **Логування**

Ведення журналу є важливим активом безпеки архітектури програми, оскільки його можна використовувати для виявлення недоліків у програмах (користувачі постійно намагаються отримати файл, який насправді не існує), а також постійних атак з боку неправомірних користувачів. Журнали зазвичай правильно генеруються веб-сервером та іншим програмним забезпеченням. Нечасто можна знайти програми, які належним чином реєструють свої дії в журналі, і, коли вони це роблять, основним призначенням журналів програми є створення вихідних даних налагодження, які можуть бути використані програмістом для аналізу конкретної помилки.

В обох випадках (сервер і журнали програми) слід протестувати та проаналізувати кілька проблем на основі вмісту журналу:

1. Чи містять журнали конфіденційну інформацію?
2. Чи журнали зберігаються на виділеному сервері?
3. Чи може використання журналу створити стан відмови в обслуговуванні?
4. Як вони обертаються? Чи журнали зберігаються протягом достатнього часу?
5. Як переглядаються журнали? Чи можуть адміністратори використовувати ці огляди для виявлення цілеспрямованих атак?
6. Як зберігаються резервні копії журналів?
7. Чи дані, що реєструються, перевіряються (мінімальна/максимальна довжина, символи тощо) перед реєстрацією?

#### **Конфіденційна інформація в журналах**

Деякі програми можуть, наприклад, використовувати запити GET для пересилання даних форми, які відображатимуться в журналах сервера. Це означає, що журнали сервера можуть містити конфіденційну інформацію (наприклад, імена користувачів як паролі або реквізити банківського рахунку). Цю конфіденційну інформацію може використати зловмисник, якщо він отримав журнали, наприклад, через адміністративні інтерфейси або відомі вразливості веб-сервера чи неправильну конфігурацію (наприклад, добре відому неправильну конфігурацію `server-status` на HTTP-серверах на основі Apache).

Журнали подій часто містять дані, корисні для зловмисника (витік інформації) або можуть бути використані безпосередньо в експлойтах:

- Інформація про налагодження
- Сліди стека
- Імена користувачів
- Назви компонентів системи
- Внутрішні IP-адреси
- Менш конфіденційні персональні дані (наприклад, адреси електронної пошти, поштові адреси та номери телефонів, пов’язані з іменами осіб)
- Бізнес-дані

Крім того, у деяких юрисдикціях зберігання певної конфіденційної інформації у файлах журналу, наприклад особистих даних, може змусити підприємство застосовувати закони про захист даних, які вони застосовуватимуть до своїх внутрішніх баз даних також до файлів журналу. І невиконання цього, навіть несвідомо, може призвести до покарання відповідно до чинного законодавства про захист даних.

Більш широкий список конфіденційної інформації:

- Вихідний код програми
- Значення ідентифікації сеансу
- Маркери доступу
- Конфіденційні персональні дані та деякі форми ідентифікаційної інформації (PII)
- Паролі автентифікації
- Рядки підключення до бази даних
- Ключі шифрування
- Дані банківського рахунку або власника платіжної картки
- Дозволено зберігати дані з вищим рівнем безпеки, ніж система реєстрації
- Комерційно конфіденційна інформація
- Збір інформації є незаконним у відповідній юрисдикції
- Інформація, яку користувач відмовився від збору або не погодився, наприклад, використання не відстежувати, або якщо термін дії згоди на збір минув

#### **Розташування журналу**

Зазвичай сервери створюють локальні журнали своїх дій і помилок, займаючи диск системи, на якій працює сервер. Однак, якщо сервер скомпрометовано, його журнали можуть бути стерті зловмисником, щоб очистити всі сліди його атаки та методів. Якби це трапилося, системний адміністратор не мав би інформації про те, як сталася атака або де знаходилося джерело атаки. Насправді більшість наборів інструментів для зловмисників включають «заппер журналів», який здатний очистити будь-які журнали, що містять надану інформацію (наприклад, IP-адресу зловмисника), і регулярно використовується в кореневих пакетах зловмисника на рівні системи.

Отже, розумніше зберігати журнали в окремому місці, а не на самому веб-сервері. Це також спрощує агрегування журналів із різних джерел, які стосуються однієї програми (наприклад, із ферми веб-серверів), а також спрощує аналіз журналів (який може інтенсивно використовувати ЦП), не впливаючи на сам сервер.

#### **Зберігання журналів**

Журнали можуть викликати стан відмови в обслуговуванні, якщо вони не зберігаються належним чином. Будь-який зловмисник з достатніми ресурсами міг би створити достатню кількість запитів, які б заповнили виділений простір для файлів журналу, якщо йому спеціально не заборонити це робити. Однак, якщо сервер налаштовано неправильно, файли журналу зберігатимуться в тому самому розділі диска, що використовується для програмного забезпечення операційної системи або самої програми. Це означає, що якщо диск буде заповнений, операційна система або програма можуть вийти з ладу, оскільки вони не можуть писати на диск.

Зазвичай у системах UNIX журнали зберігаються в /var (хоча деякі установки сервера можуть знаходитися в /opt або /usr/local), і важливо переконатися, що каталоги, в яких зберігаються журнали, знаходяться в окремому розділі. У деяких випадках і для того, щоб запобігти впливу на системні журнали, каталог журналу самого серверного програмного забезпечення (наприклад, /var/log/apache на веб-сервері Apache) слід зберігати у спеціальному розділі.

Це не означає, що журналам слід дозволити рости, щоб заповнити файлову систему, у якій вони зберігаються. Зростання журналів сервера слід відстежувати, щоб виявити цю умову, оскільки вона може свідчити про атаку.

Перевірити цю умову так само легко та небезпечно у виробничих середовищах, як і відправити достатню та постійну кількість запитів, щоб перевірити, чи реєструються ці запити та чи є можливість заповнити розділ журналу за допомогою цих запитів. У деяких середовищах, де параметри QUERY_STRING також реєструються незалежно від того, створюються вони за допомогою запитів GET чи POST, можна симулювати великі запити, які заповнюватимуть журнали швидше, оскільки, як правило, один запит спричиняє лише невелику кількість даних. зареєстровані, як-от дата й час, вихідна IP-адреса, запит URI та результат сервера.

#### **Обертання журналу**

Більшість серверів (але небагато користувацьких програм) чергуватимуть журнали, щоб запобігти заповненню ними файлової системи, у якій вони розміщені. Під час ротації журналів передбачається, що інформація в них потрібна лише протягом обмеженого періоду часу.

Цю функцію слід протестувати, щоб переконатися, що:

- Журнали зберігаються протягом часу, визначеного в політиці безпеки, не більше і не менше.
- Журнали стискаються після обертання (це зручно, оскільки це означатиме, що для того самого доступного дискового простору зберігатиметься більше журналів).
- Дозволи файлової системи змінених файлів журналу такі самі (або суворіші), що й для самих файлів журналу. Наприклад, веб-серверам потрібно буде писати в журнали, які вони використовують, але насправді їм не потрібно писати в ротовані журнали, що означає, що дозволи на файли можна змінити під час ротації, щоб запобігти зміні процесу веб-сервера.

Деякі сервери можуть обертати журнали, коли вони досягають заданого розміру. Якщо це станеться, необхідно переконатися, що зловмисник не зможе змусити журнали обертатися, щоб приховати свої сліди.

#### **Контроль доступу до журналу**

Інформація журналу подій ніколи не повинна бути видимою для кінцевих користувачів. Навіть веб-адміністратори не повинні бачити такі журнали, оскільки це порушує розподіл функцій контролю. Переконайтеся, що будь-яка схема керування доступом, яка використовується для захисту доступу до необроблених журналів, і будь-які програми, які надають можливості для перегляду або пошуку в журналах, не пов’язані зі схемами керування доступом для інших ролей користувачів програми. Неавтентифіковані користувачі також не повинні переглядати дані журналу.

#### **Огляд журналу**

Перегляд журналів можна використовувати не лише для отримання статистики використання файлів на веб-серверах (на чому зазвичай зосереджується більшість програм, що базуються на журналі), але й для визначення того, чи відбуваються атаки на веб-сервері.

Щоб аналізувати атаки веб-сервера, необхідно проаналізувати файли журналу помилок сервера. Огляд має бути зосереджений на:

- 40x (не знайдено) повідомлень про помилку. Велика їх кількість з одного джерела може свідчити про те, що інструмент сканування CGI використовується проти веб-сервера
- 50x (помилка сервера) повідомлень. Це може бути ознакою того, що зловмисник зловживає частинами програми, які несподівано виходять з ладу. Наприклад, на перших етапах атаки SQL-ін’єкцій буде створено таке повідомлення про помилку, коли SQL-запит не сформовано належним чином і його виконання не вдасться виконати у внутрішній базі даних.

Статистику чи аналіз журналів не слід генерувати чи зберігати на тому самому сервері, який створює журнали. В іншому випадку зловмисник може через уразливість веб-сервера або неправильну конфігурацію отримати до них доступ і отримати подібну інформацію, яка була б розкрита самими файлами журналу.
